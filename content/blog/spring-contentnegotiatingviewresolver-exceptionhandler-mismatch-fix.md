+++
title = "Spring ContentNegotiatingViewResolver ExceptionHandler mismatch fix"
date = 2011-08-05T13:33:00Z
updated = 2011-08-05T13:33:05Z
tags = ["Code"]
blogimport = true 
[author]
	name = "Sean Wesenberg"
	uri = "https://plus.google.com/111523202047342274226"
+++

<div class="p1">The org.springframework.web.servlet.view.ContentNegotiatingViewResolver let's you map a response from your controller and have it auto formatted without a nary of hint in the actual code. However, exception handling of the controller does not seem to follow this&nbsp;ideology. Maybe this will be fixed in a future version (I hope) or is already fixed in a newer version (don't feel like upgrading libs atm). For context, I'm using Spring 3.0.5-Release.&nbsp;</div><div class="p1"><br /></div><div class="p1">Here is how my exception handler should look and act.&nbsp;</div><div class="p1">        </div><div class="p1"><br /></div><div class="p2">&nbsp; <span class="s1">@ExceptionHandler</span>(KnownException.<span class="s2">class</span>)</div><div class="p2">&nbsp; <span class="s2">public</span> SessionResponse handleException(KnownException e, HttpServletRequest request) {</div><div class="p2">&nbsp; &nbsp; SessionResponse response = <span class="s2">new</span> SessionResponse();</div><div class="p2">&nbsp; &nbsp; response.<span class="s3">errorCode</span> = e.<span class="s3">code</span>;</div><div class="p2">&nbsp; &nbsp; <span class="s2">return</span> response;</div><div class="p2">&nbsp; }</div><div class="p2"><br /></div><div class="p2">SessionResponse is just a POJO, nothing special. However, Spring doesn't like this approach and says that it can not find a ContentNegotiatingBlahBlah...&nbsp;</div><br /><br /><br />To make it work, you can do the following...<br /><br /><br /><div class="p2">&nbsp; <span class="s1">@ExceptionHandler</span>(KnownException.<span class="s2">class</span>)</div><div class="p2">&nbsp; <span class="s2">public</span> ModelAndView handleException(KnownException e, HttpServletRequest request) {</div><div class="p2">&nbsp; &nbsp; SessionResponse response = <span class="s2">new</span> SessionResponse();</div><div class="p2">&nbsp; &nbsp; response.<span class="s3">errorCode</span> = e.<span class="s3">code</span>;</div><div class="p2">&nbsp; &nbsp; <span class="s2">return</span> <span class="s2">new</span> ModelAndView(<span class="s4">""</span>, <span class="s4">"error"</span>, response);</div><div class="p2">&nbsp; }</div><div class="p2"><br /></div><div class="p2">For whatever reason, wrapping it in a ModelAndView object will trigger spring to render the output correctly. Which, in my case is JSON or XML based on the suffix used for the request.&nbsp;</div><div class="p2"><br /></div><div class="p2">Maybe this will help someone else. Googling only turns up forum posts with no answers.&nbsp;</div><div class="p2"><br /></div><div class="p2">References:</div><div class="p2"><br /></div><div class="p2">http://forum.springsource.org/archive/index.php/t-82802.html</div>
