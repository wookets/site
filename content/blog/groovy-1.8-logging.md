+++
title = "Groovy 1.8 Logging"
date = 2011-09-04T09:10:00Z
updated = 2011-09-17T14:23:23Z
tags = ["Code"]
blogimport = true 
[author]
	name = "Sean Wesenberg"
	uri = "https://plus.google.com/111523202047342274226"
+++

Finally, logging that makes some sense...<br /><br />In Groovy 1.8 they added a very nifty new way to do logging. But first, let's revisit how we used to do logging.<br /><br /><div class="p1">&lt;code&gt;</div><div class="p2">&nbsp; <span class="s1">private</span> <span class="s1">static</span> <span class="s1">final</span> Logger <span class="s2">log</span> = Logger.getLogger(CrudService.<span class="s1">class</span>);</div><div class="p2"><br /></div><div class="p2"></div><div class="p1"><span class="s1">&nbsp; &nbsp;if</span>(<span class="s2">log</span>.isDebugEnabled()) {</div><div class="p1">&nbsp; &nbsp; &nbsp; String debugMsg = <span class="s3">"INCOMING:: Create: "</span> + resource.getClass() + <span class="s3">"::"</span> + resource.getId();</div><div class="p1">&nbsp; &nbsp; &nbsp; <span class="s2">log</span>.debug(debugMsg);</div><div class="p1">&nbsp; &nbsp; }</div>&lt;/code&gt;<br /><br />The main problem with the above piece of code is the inane amount of verbosity used to do something that should be really really really simple. No wonder people resort to doing System.out.*<br /><br />1. private static blah blah blah is way too long and cryptic for your newbe programmer.<br /><br />2. checking if(log.isDebugEnabled()) should be handled by the log method more intelligently. Btw, this if statement is typically used for performance. String concats are expensive. Even this day in age, saving a few CPU cycles is nice.<br /><br />A few months ago, I set out to tackle this problem in my apps using Spring. The solution I came up with was actually somewhat decent and resorted to using injection.<br /><br />&lt;code&gt;<br /><br /><div class="p1">&nbsp;<span class="s1">@</span><span class="s2">Logger</span>&nbsp;private Log <span class="s3">log;</span></div><br />&lt;/code&gt;<br /><br />Using a bean&nbsp;initializer&nbsp;class, we can inject the proper logging mechanism into the class based on the class. The essential code from this class is below.<br /><br />&lt;code&gt;<br /><br /><div class="p2">&nbsp; &nbsp; ReflectionUtils.doWithFields(bean.getClass(), <span class="s1">new</span> FieldCallback() {</div><div class="p2">&nbsp; &nbsp; &nbsp; <span class="s1">public</span> <span class="s1">void</span> doWith(Field field) <span class="s1">throws</span> IllegalArgumentException, IllegalAccessException {</div><div class="p3"><span class="s2">&nbsp; &nbsp; &nbsp; &nbsp; </span>// make the field accessible if defined private</div><div class="p2">&nbsp; &nbsp; &nbsp; &nbsp; ReflectionUtils.makeAccessible(field);</div><div class="p2">&nbsp; &nbsp; &nbsp; &nbsp; <span class="s1">if</span>(field.getAnnotation(<span class="s3">Logger</span>.<span class="s1">class</span>) != <span class="s1">null</span>) {</div><div class="p2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Log log = LogFactory.getLog(bean.getClass());</div><div class="p2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; field.set(bean, log);</div><div class="p2">&nbsp; &nbsp; &nbsp; &nbsp; }</div><div class="p2">&nbsp; &nbsp; &nbsp; }</div><div class="p2">&nbsp; &nbsp; });</div><div class="p2">&nbsp; &nbsp; <span class="s1">return</span> bean;</div><br />&lt;/code&gt;<br /><br />However, it still isn't as nice as it should be... I mean, I was typing out @Logger, Log, log in every class. I should be able to type 'Log' and the class should know what to do. I don't see the sense in repeating 3 pretty obvious keywords in each class to let it know what I want to do.<br /><br />Groovy has finally made this better for all of us. At the top of your class simply add...<br /><br />&lt;code&gt;<br /><span class="Apple-style-span" style="background-color: white; color: grey; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; font-size: 13px; line-height: 15px; white-space: pre-wrap;">@Log</span><br />&lt;/code&gt;<br /><br />Just one annotation. Which is how it should be.<br /><br />Above I said, 'makes some sense.' With an emphasis on 'some'. I'm not quite sure why there are four separate annotions for different logging frameworks. Well, I do know why... Groovy eventually compiles into Java and the Java must know something about what it needs to do and we aren't using Spring or any fancy AOP or AspectJ things, so... I guess for now it's a small concession to make to have cleaner code.<br /><br />References:<br /><br /><a href="http://docs.codehaus.org/display/GROOVY/Groovy+1.8+release+notes#Groovy1.8releasenotes-@Log">http://docs.codehaus.org/display/GROOVY/Groovy+1.8+release+notes#Groovy1.8releasenotes-@Log</a><br /><br /><br />
