+++
title = "Apache Ivy Private Repository"
date = 2011-10-17T22:28:00Z
updated = 2011-10-19T12:13:49Z
tags = ["Code"]
blogimport = true 
[author]
	name = "Sean Wesenberg"
	uri = "https://plus.google.com/111523202047342274226"
+++

If you want your open source project to succeed, write good documentation... or just have a bunch of people blog about it and do it for you.<br /><br />I have recently been playing around with <a href="http://ant.apache.org/ivy/">Apache Ivy</a> and trying to get it to work. Yes, I've looked at Maven. To be honest, I don't want / need a build system. Right click export is how I build and while that my seem crude to you, I really only release every two or so weeks. And, I full expect my CI to do my building and deploying for me (more in a later blog post).<br /><br />When hunting down a dependency management system, these were the objectives I set out to conquer;<br /><br /><ul><li>Allows for privately hosted repository. Huge bonus points for being able to run this off an S3 web enabled bucket.&nbsp;</li><li>Setting dependencies and configuration is easy and minimal. I hate xml, but hey, it's ok for now.&nbsp;</li><li>A cloud based service would be nice, but running my own would be fine as well. As long as I can host it off S3.&nbsp;</li><li>Integrates well with eclipse / WTP. No command line here. IDE support is a must.&nbsp;</li><li>Can pull down more than just jar files. I would like to expand this beyond the server side and potentially use it in our client side (flex / html5) projects.&nbsp;</li></ul><div>But, enough talk, let's get to it. Btw, this is all assuming your using <a href="http://ant.apache.org/ivy/ivyde/index.html">IvyDE</a>.&nbsp;</div><div><br /></div><div>1. Let's get a basic ivy file going in our project;&nbsp;</div><div><br /></div><div>{project_home}/ivy.xml</div><div><br /></div><pre class="brush: xml"><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;<br />&lt;ivy-module version=&quot;2.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br />       xsi:noNamespaceSchemaLocation=&quot;http://ant.apache.org/ivy/schemas/ivy.xsd&quot;&gt;<br />    &lt;info organisation=&quot;yourorg&quot; module=&quot;yourproject&quot;/&gt;<br />    &lt;dependencies&gt;<br />        &lt;dependency org=&quot;commons-lang&quot; name=&quot;commons-lang&quot; rev=&quot;2.0&quot;/&gt;<br />    &lt;/dependencies&gt;<br />&lt;/ivy-module&gt;<br /></pre><div><div class="p4"><br /></div><div class="p4">The &lt;info /&gt; tag here is really of no consequence. It just tells Ivy what this file is for. We'll see later how this fits in when we create our own repository.&nbsp;</div><div class="p4"><br /></div><div class="p4">The &lt;dependencies /&gt; tag is the meat of what we want. Here you can line item your dependencies that are included into your project.&nbsp;</div><div class="p4"><br /></div><div class="p4">Now, IvyDE includes some default settings;&nbsp;</div><div class="p4"></div><ol><li>It will use the public ibiblio maven repository,&nbsp;</li><li>It will automatically resolve (attempt to download) dependencies once you save the ivy file in your project,&nbsp;</li><li>In your project library settings, you can simply choose to use the 'ivy' library and the plugin will realize you want the dependencies you've defined in ivy.xml to be included in your project build path.&nbsp;</li></ol></div><div>With that being said, if you include the above line it might actually start downloading and resolving commons-lang. Btw, the org for commons-lang might need to be set to apache. But, we'll see later about that.&nbsp;</div><div><br /></div><div>2. Let's write our own ivy settings file;&nbsp;</div><div><br /></div><div>Now we can resolve dependencies (or maybe you're stuck already) against the default settings, but what about resolving against our own settings file.&nbsp;</div><div><br /></div><div>You can create an ivysettings.xml file that will allow you to tell Ivy what repositories to use when looking for dependencies. Here is a basic one.&nbsp;</div><div><br /></div><div>ivysettings.xml</div><div><br /></div><div><div class="p1"><pre class="brush: xml"><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;<br />&lt;ivysettings&gt;<br />    &lt;property name=&quot;repo.url&quot; value=&quot;http://repo.wookets.com&quot;/&gt;<br />    &lt;settings defaultResolver=&quot;myrepo&quot;/&gt;<br />    &lt;resolvers&gt;<br />      &lt;url name=&quot;myrepo&quot;&gt;  <br />        &lt;ivy pattern=&quot;${repo.url}/[organisation]/[module]/ivy-[revision].xml&quot; /&gt;  <br />        &lt;artifact pattern=&quot;${repo.url}/[organisation]/[module]/[artifact]-[revision].[ext]&quot; /&gt;  <br />      &lt;/url&gt;<br />    &lt;/resolvers&gt;<br />&lt;/ivysettings&gt;<br /></pre></div></div><div><br /></div><div>You can place ivysettings.xml right next to your ivy.xml project file. Or, you can place it elsewhere. In IvyDE you simply go into your eclipse preferences -&gt; ivy -&gt; settings and change the location. Here is an example of my string;&nbsp;${workspace_loc:TestIvy/ivysettings.xml} Where TestIvy is my project.&nbsp;</div><div><br /></div><div>The settings file we're using is intentionally non-complex. Ivy has a bunch of conf and namespace type stuff, but let's keep it simple until we run into a problem and then adapt, rather than configuring things for the sake of configuring them.&nbsp;</div><div><br /></div><div>The &lt;property /&gt; tag abstracts out repo.url. You can include this or not or add more.&nbsp;</div><div><br /></div><div>The &lt;settings /&gt; tag is used to define a defaultResolver. In our case this is our private repository with our jar files.&nbsp;</div><div><br /></div><div>The &lt;resolvers /&gt; tag is used to define our repo. There are a few more options for this tag... chaining, etc, but again, keep it simple.&nbsp;</div><div><br /></div><div>The &lt;url /&gt; tag finally defines our repository. &lt;ivy /&gt; will resolve to the ivy file (see the next step) and &lt;artifact /&gt; will define the pattern to reach our files.&nbsp;</div><div><br /></div><div>3. Let's create our own repository using ivy files and jars;</div><div><br /></div><div>Remember in our first step where we created our ivy.xml file and set stuff on the &lt;info /&gt; tag. Well, here is where that comes into play. ivy.xml tags are used to both define dependencies AND publish dependencies. It's a little tricky, but ivy.xml files allow you to pull in jars and also pull together jars for other ivy.xml files.&nbsp;</div><div><br /></div><div>So, here is an example of an ivy.xml jar that is publishing and also defining dependencies, which will resolve to their own ivy.xml files.&nbsp;</div><div><br /></div><div>{repo}/spring/all/ivy-3.0.5.RELEASE.xml</div><div><br /></div><div><pre class="brush: xml"><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;<br />&lt;ivy-module version=&quot;2.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br />       xsi:noNamespaceSchemaLocation=&quot;http://ant.apache.org/ivy/schemas/ivy.xsd&quot;&gt;<br />  <br />  &lt;info organisation=&quot;spring&quot; module=&quot;all&quot; revision=&quot;3.0.5.RELEASE&quot;/&gt;<br /><br />  &lt;publications&gt;<br />    &lt;artifact name=&quot;org.springframework.aop&quot; ext=&quot;jar&quot; /&gt;<br />    &lt;artifact name=&quot;org.springframework.asm&quot; ext=&quot;jar&quot; /&gt;<br />    &lt;artifact name=&quot;org.springframework.aspects&quot; ext=&quot;jar&quot; /&gt;<br />    &lt;artifact name=&quot;org.springframework.beans&quot; ext=&quot;jar&quot; /&gt;<br />    &lt;artifact name=&quot;org.springframework.context&quot; ext=&quot;jar&quot; /&gt;<br />    &lt;artifact name=&quot;org.springframework.core&quot; ext=&quot;jar&quot; /&gt;<br />  &lt;/publications&gt;<br /><br />  &lt;dependencies&gt;<br />     &lt;dependency org=&quot;apache&quot; name=&quot;commons-beanutils&quot; rev=&quot;1.8.0&quot;/&gt;<br />     &lt;dependency org=&quot;apache&quot; name=&quot;commons-logging&quot; rev=&quot;1.1&quot;/&gt;<br />  &lt;/dependencies&gt;<br /><br />&lt;/ivy-module&gt;<br /></pre></div><div><br /></div><div>First, you need to realize that the pattern we defined in ivysettings.xml is used to find this ivy.xml file. You can change ivysettings.xml and make the pattern more simple or more complex. It's up to you.&nbsp;</div><div><br /></div><div>Next, realize that this is just an ivy.xml file. Just like the one from step 1. Except, we have a &lt;publications /&gt; tag here that defines artifacts. Artifacts are jar or any other type of file that you want to have eventually downloaded into your project.&nbsp;</div><div><br /></div><div>And since this is just an ivy.xml file, we can of course include &lt;dependencies /&gt; which will use our ivysettings.xml to resolve themselves to the proper location.&nbsp;</div><div><br /></div><div>Now, all of these files I've presented probably won't work together. But, how ivy.xml files are linked is by the following...&nbsp;</div><div><br /></div><div>&lt;dependency org="" /&gt;&nbsp;resolves itself to &lt;info organisation=""/&gt; in another ivy.xml tag.&nbsp;</div><div>&lt;dependency name=""/&gt; resolves itself to &lt;info module=""/&gt; in another ivy.xml tag.&nbsp;</div><div>&lt;dependency rev=""/&gt; resolves itself to &lt;info revision=""/&gt; in another ivy.xml tag.&nbsp;</div><div><br /></div><div>And, all of these are used in our ivysettings.xml patterns to resolve the file path.&nbsp;</div><div><br />You don't need any special software or to run any ant build type stuff (if you're using IvyDE), so it isn't too bad. The files can be created by hand. There are ways to import existing repositories, so you don't have to create as much. Me, I like to start fresh and clean.<br /><br /></div><div>I hope this has helped make Ivy a little bit clearer... It is really simply actually, but I don't think the documentation is that great. A diagram or two would be nice. Perhaps in the future I will make one... But for now, I need to catch some sleep.&nbsp;</div><div><br /></div><div>Btw, sorry about the lacky of script / xml styling... Still need to fix that... It's on my todo list...&nbsp;</div>
