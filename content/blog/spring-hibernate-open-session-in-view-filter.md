+++
title = "Spring Hibernate Open Session In View Filter"
date = 2005-12-02T22:03:00Z
updated = 2005-12-02T22:05:57Z
blogimport = true 
[author]
	name = "Sean Wesenberg"
	uri = "https://plus.google.com/111523202047342274226"
+++

Hibernate allows use to efficiently query relationships from a database via lazy-loading. However, relationships which are lazily-loaded can not be accessed if the hibernate session goes out of view.<br /><br /><code> #{Album.artist.name}<br /></code><br />Because of lazy loading, if you try to do the preceding relationship access in your EL (web page) statement, a lazy load error will be thrown. This is because if you are using JSF or some other non spring friendly web layer, and your session will cut out in the service layer.<br /><br />To allow the above EL expression to take place, you can add the following filter to your web.xml.<br /><code><filter><br />     <filter-name>sessionFilter</filter-name><br />     <filter-class>wookets.utility.OpenSessionInViewFilter</filter-class><br /> </filter>       <filter-mapping><br />     <filter-name>sessionFilter</filter-name><br />     <url-pattern>/faces/*</url-pattern></filter-mapping></code><br /><br />However, because the default spring open session in view filter never flushes, you can never save anything in your web pages. To enable the session in view filter to flush, use the following class which extends the original spring session in view filter.<br /><br /><code><br />package wookets.utility;<br /><br />import org.hibernate.FlushMode;<br />import org.hibernate.Session;<br />import org.hibernate.SessionFactory;<br />import org.springframework.dao.DataAccessResourceFailureException;<br />import org.springframework.orm.hibernate3.SessionFactoryUtils;<br /><br />/**<br />* @author wookets and an unknown person<br />*<br />*/<br />public class OpenSessionInViewFilter extends org.springframework.orm.hibernate3.support.OpenSessionInViewFilter {<br /><br /> /**<br />  * we do a different flushmode than in the codebase here<br />  */<br /> protected Session getSession(SessionFactory sessionFactory) throws DataAccessResourceFailureException {<br />   Session session = SessionFactoryUtils.getSession(sessionFactory, true);<br />   session.setFlushMode(FlushMode.COMMIT);<br />   return session;<br /> }<br /><br /> /**<br />  * we do an explicit flush here just in case we do not have an automated flush<br />  */<br /> protected void closeSession(Session session, SessionFactory factory) {<br />   session.flush();<br />   super.closeSession(session, factory);<br /> }<br />}<br /></code><br /><br />I haven't yet spent time dealing with lazy loads in remoting instances, so I'm not sure how that will all turn out. Hopefully, EJB3 and the Hibernate Entity Manager will solve these problems.<br /><br />Links to other pages:<br />http://www.hibernate.org/43.html<br /><br />Btw, if anyone can point me to the person that originally wrote this useful class, I will gladely give them credit.
