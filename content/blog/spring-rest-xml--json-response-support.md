+++
title = "Spring REST XML / JSON Response Support"
date = 2011-04-22T14:22:00Z
updated = 2011-04-24T14:57:45Z
blogimport = true 
[author]
	name = "Sean Wesenberg"
	uri = "https://plus.google.com/111523202047342274226"
+++

Spent a while sifting and reading on this topic, so hopefully this will add or help your search. The goal is to accept an HTTP GET / POST (I suppose PUT and DELETE could work as well) and return a response in XML or JSON. <br /><br />spring-config.xml - Our spring configuration file for view resolution.<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> &lt;!-- oxm integration --&gt;  <br />  &lt;bean id="objectXmlMarshaller" class="org.springframework.oxm.xstream.XStreamMarshaller" /&gt;  <br />  &lt;!-- rest support --&gt;  <br />  &lt;bean class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver"&gt;  <br />   &lt;property name="defaultContentType" value="application/xml" /&gt;  <br />   &lt;property name="ignoreAcceptHeader" value="true" /&gt;  <br />   &lt;property name="favorPathExtension" value="true" /&gt;  <br />   &lt;property name="mediaTypes"&gt;  <br />    &lt;map&gt;  <br />     &lt;entry key="xml" value="application/xml" /&gt;  <br />     &lt;entry key="json" value="application/json" /&gt;  <br />    &lt;/map&gt;  <br />   &lt;/property&gt;  <br />   &lt;property name="defaultViews"&gt;  <br />    &lt;list&gt;  <br />     &lt;bean class="org.springframework.web.servlet.view.json.MappingJacksonJsonView" /&gt;  <br />     &lt;bean class="org.springframework.web.servlet.view.xml.MarshallingView"&gt;  <br />      &lt;property name="marshaller" ref="objectXmlMarshaller" /&gt;  <br />     &lt;/bean&gt;  <br />    &lt;/list&gt;  <br />   &lt;/property&gt;  <br />  &lt;/bean&gt;  <br /></code></pre><br />LoginService.java - Just a standard service method in java. My top level class is @Controller annotated. <br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> @RequestMapping(value = "/login")  <br />  public LoginResponse handleLogin(@RequestParam String username, @RequestParam String password) {  <br />   LoginResponse response = new LoginResponse();  <br />   try {  <br />    this.loginManager.login(username, password);  <br />   } catch(AuthenticationException e) {  <br />    response.errorCode = e.code;  <br />    return response;  <br />   }  <br />   // all good?  <br />   response.sessionToken = this.userSession.getSessionId();  <br />   return response;  <br />  }  <br /></code></pre><br />LoginResponse.java - our data transfer object<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> @XStreamAlias("response")  <br /> public class LoginResponse {  <br />  public String sessionToken;  <br />  public String errorMessage;  <br />  public String errorCode;  <br /> }  <br /></code></pre><br />web.xml - make sure the spring mvc dispather will handle incoming requests<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> &lt;!-- Handles all requests into the application --&gt;  <br />  &lt;servlet&gt;  <br />   &lt;servlet-name&gt;Spring MVC Dispatcher Servlet&lt;/servlet-name&gt;  <br />   &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;  <br />   &lt;init-param&gt;  <br />    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;  <br />    &lt;param-value&gt;/WEB-INF/spring-web.xml,/WEB-INF/classes/spring-*.xml&lt;/param-value&gt;  <br />   &lt;/init-param&gt;  <br />   &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;  <br />  &lt;/servlet&gt;  <br />  &lt;servlet-mapping&gt;  <br />   &lt;servlet-name&gt;Spring MVC Dispatcher Servlet&lt;/servlet-name&gt;  <br />   &lt;url-pattern&gt;/&lt;/url-pattern&gt;  <br />  &lt;/servlet-mapping&gt;  <br /></code></pre><br />Things to possibly ignore: <br />1. LoginResponse can be any object, but I threw it in there just for example.<br />2. web.xml configuration is standard, so can ignore if you already have the mvc dispatcher setup.<br />3. LoginService is pretty standard as well. Hopefully the annotations are self explanatory. <br /><br />More important things:<br />1. The properties on the ContentNegotiatingViewResolver bean may prove to be more important than meets the eye. I couldn't get things to work (both xml / json responses) without those properties. I understand the class, but not the exact semantics. <br /><br />2. The mediaTypes property will map a uri extension to a view. <br />E.g. <br />http://localhost:8080/Service/login.xml - will use the xml marsheller to return xml. <br />http://localhost:8080/Service/login.json - will use the jackson view to return json. <br /><br />3. You'll get an error, but remember to put the jackson and xstream jar files in your lib. I suppose you could swap out for another library that spring supports. <br /><br />4. Lastly, I'm using the objectXmlMarshaller in other parts of my application and I wrote a Spring bootstrapper to scan the classpath and read in the xml annotations to do the aliasing. There is a property on the marshaller, but you can read about the drawbacks of the auto-detect mode. <br /><br />Hope this helps. <br /><br />References:<br /><br /><ul><li><a href="http://www.rickherrick.com/?q=node/63">http://www.rickherrick.com/?q=node/63</a></li><li><a href="http://stackoverflow.com/questions/4703412/spring-rest-3-to-support-xml-and-json">http://stackoverflow.com/questions/4703412/spring-rest-3-to-support-xml-and-json</a></li><li><a href="http://eggsylife.co.uk/2010/01/03/spring-3-restful-web-services/">http://eggsylife.co.uk/2010/01/03/spring-3-restful-web-services/</a></li><li><a href="http://forum.springsource.org/showthread.php?t=82146">http://forum.springsource.org/showthread.php?t=82146</a></li><li><a href="http://static.springsource.org/spring/docs/3.0.0.M3/spring-framework-reference/html/ch16s11.html">http://static.springsource.org/spring/docs/3.0.0.M3/spring-framework-reference/html/ch16s11.html</a></li><li><a href="http://static.springsource.org/spring/docs/3.0.0.M3/spring-framework-reference/html/ch18s02.html">http://static.springsource.org/spring/docs/3.0.0.M3/spring-framework-reference/html/ch18s02.html</a></li></ul>
