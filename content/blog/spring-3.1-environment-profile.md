+++
title = "Spring 3.1 Environment Profile"
date = 2011-11-08T09:24:00Z
updated = 2011-11-14T19:49:54Z
tags = ["Code"]
blogimport = true 
[author]
	name = "Sean Wesenberg"
	uri = "https://plus.google.com/111523202047342274226"
+++

<br />The most useful addition to Spring 3.1 I've found is support for environments (called Profiles).<br /><br />Here is the official post on this topic.<br /><br /><a href="http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/">http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/</a><br /><br />Profiles allow you to add / remove features / settings of your application based on the environment it is actually running in.<br /><br />Example:<br /><br /><pre class="brush:xml">  &lt;beans profile="beta"&gt;<br />    &lt;bean id="appProperties" class="wookets.bootstrap.AppProperties"&gt;<br /> &lt;property name="someprop" value="CHEESE"/&gt;<br />    &lt;/bean&gt;<br />  &lt;/beans&gt;<br />  &lt;beans profile="local"&gt;<br />     &lt;bean id="appProperties" class="wookets.bootstrap.AppProperties"&gt;<br /> &lt;property name="someprop" value="WAFFLES"/&gt;<br />     &lt;/bean&gt;<br />  &lt;/beans&gt;<br /></pre><br /><br />If we are running the application on our beta server, we'll get CHEESE.<br />If we are running the applciation on our local server, we'll get WAFFLES.<br /><br />But, how do we initially set the environment variable? There is a great post on this <a href="http://javasplitter.blogspot.com/2011/06/bean-definition-profiles-and.html">here</a>...<br /><br /><b>Environment Variable:</b><br />-D spring.profiles.active=production<br /><br /><b>System Property:</b><br />export spring.profiles.active=production<br /><br /><b>web.xml:</b><br />&lt;servlet&gt; <br />&nbsp; &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt; <br />&nbsp; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;<br />&nbsp; &lt;init-param&gt; <br />&nbsp; &nbsp; &lt;param-name&gt;spring.profiles.active&lt;/param-name&gt; <br />&nbsp; &nbsp; &lt;param-value&gt;production&lt;/param-value&gt; <br />&nbsp; &lt;/init-param&gt; <br />&lt;/servlet&gt;<br /><br />Update:<br /><br />web.xml init-param doesn't work for me... But this does...<br /><br /><div class="p1"><span class="s2"><br /></span></div><div class="p1"><span class="s2">&lt;</span>env-entry<span class="s2">&gt;</span></div><div class="p2"><span class="s1">&nbsp; <span class="Apple-tab-span"> </span></span><span class="s2">&lt;</span>env-entry-name<span class="s2">&gt;</span><span class="s1">spring.profiles.active</span><span class="s2">&lt;/</span>env-entry-name<span class="s2">&gt;</span></div><div class="p2"><span class="s1">&nbsp;&nbsp;</span><span class="s2">&lt;</span>env-entry-type<span class="s2">&gt;</span><span class="s1">java.lang.String</span><span class="s2">&lt;/</span>env-entry-type<span class="s2">&gt;</span></div><div class="p2"><span class="s1">&nbsp;&nbsp;</span><span class="s2">&lt;</span>env-entry-value<span class="s2">&gt;</span><span class="s1">local</span><span class="s2">&lt;/</span>env-entry-value<span class="s2">&gt;</span></div><div class="p2"><span class="s2">&lt;/</span>env-entry<span class="s2">&gt;</span></div><br /><br />The above should be added to web.xml (not under a servlet, but just in the root of the file with everything else...) It sets the environment variable and then from there spring will pick up the profile...<br /><br />Btw, in eclipse, you can configure this by doing the following...<br /><br />1. Go to the 'servers' view.<br />2. Double click on your server.<br />3. Click on the 'launch configuration' link.<br />4. Select the 'environment' tab.<br />5. Click 'new...'<br />6. Name is: spring.profiles.active<br />7. Value is: local (or whatever your environment that you want your app to run locally in...)<br /><br />In your junit tests, simply add&nbsp;@ActiveProfiles("test")&nbsp;to the top of the test class.<br /><div><br /></div><br />One hitch:<br />AWS Beanstalk does not currently allow custom named environment variables to be passed in... That is, you're stuck with 'PARAM#', which is not 'spring.profiles.active'.<br /><br />Update - One hitch undone...<br />AWS Beanstalk does allow java system properties to be passed in. So...<br /><br />-Dspring.profiles.active=beta<br /><br />Does in fact work. Note, this will NOT override web.xml, which is a bummer, since could have our default 'local' in web.xml and then on our servers override with the proper enviro....<br /><br /><br />Resources:<br /><br /><a href="http://javasplitter.blogspot.com/2011/06/bean-definition-profiles-and.html">http://javasplitter.blogspot.com/2011/06/bean-definition-profiles-and.html</a><br /><br /><a href="http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/">http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/</a><br /><br /><a href="https://www.google.com/search?gcx=c&amp;sourceid=chrome&amp;ie=UTF-8&amp;q=aws+beanstalk+custom+environment+variables">https://www.google.com/search?gcx=c&amp;sourceid=chrome&amp;ie=UTF-8&amp;q=aws+beanstalk+custom+environment+variables</a><br /><br /><a href="http://blog.springsource.com/2011/06/21/spring-3-1-m2-testing-with-configuration-classes-and-profiles/">http://blog.springsource.com/2011/06/21/spring-3-1-m2-testing-with-configuration-classes-and-profiles/</a><br /><br />
